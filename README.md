# üèóÔ∏è Enterprise-Grade Three-Tier Architecture on AWS

[![CI - API](https://github.com/thejondaw/devops-project/actions/workflows/ci-api.yaml/badge.svg)](https://github.com/thejondaw/devops-project/actions/workflows/ci-api.yaml)
[![CI - Web](https://github.com/thejondaw/devops-project/actions/workflows/ci-web.yaml/badge.svg)](https://github.com/thejondaw/devops-project/actions/workflows/ci-web.yaml)
[![CD - Infrastructure](https://github.com/thejondaw/devops-project/actions/workflows/cd-infrastructure.yaml/badge.svg)](https://github.com/thejondaw/devops-project/actions/workflows/cd-infrastructure.yaml)
[![CD - Post Install](https://github.com/thejondaw/devops-project/actions/workflows/post-install.yaml/badge.svg)](https://github.com/thejondaw/devops-project/actions/workflows/post-install.yaml)
[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=thejondaw_devops-project&metric=alert_status)](https://sonarcloud.io/summary/new_code?id=thejondaw_devops-project)

Production-ready implementation of a three-tier architecture leveraging modern DevOps practices, Infrastructure as Code, and GitOps methodologies.

## üèõÔ∏è Application Architecture

The project implements a classic three-tier architecture with modern cloud-native enhancements:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                            VPC                           ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ                 (2x PRIVATE SUBNETS)                 ‚îÇ ‚îÇ
‚îÇ ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ ‚îÇ
‚îÇ ‚îÇ   ‚îÇ               TIER I - DATABASE              ‚îÇ   ‚îÇ ‚îÇ
‚îÇ ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ ‚îÇ
‚îÇ ‚îÇ        ‚îÇ           ‚îÇ            ‚îÇ           ‚îÇ        ‚îÇ ‚îÇ
‚îÇ ‚îÇ     DB_NAME     DB_PORT      DB_USER     DB_PASS     ‚îÇ ‚îÇ
‚îÇ ‚îÇ        ‚îÇ           ‚îÇ            ‚îÇ           ‚îÇ        ‚îÇ ‚îÇ
‚îÇ ‚îÇ        ‚ñº           ‚ñº            ‚ñº           ‚ñº        ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïë                                                  ‚ïë ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïë                   (EKS CLUSTER)                  ‚ïë ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïë                                                  ‚ïë ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïë  ‚îå‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îê  ‚ïë ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïë  ‚îÇ               TIER II - API                ‚îÇ  ‚ïë ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚ïë ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïë             ‚ñ≤                      ‚ñ≤             ‚ïë ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïë             ‚îÇ                      ‚îÇ             ‚ïë ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚ïë‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïë‚îÄ‚îò ‚îÇ
‚îÇ   ‚ïë             ‚îÇ                      ‚îÇ             ‚ïë   ‚îÇ
‚îÇ   ‚ïë          API_HOST               API_PORT         ‚ïë   ‚îÇ
‚îÇ   ‚ïë             ‚îÇ                      ‚îÇ             ‚ïë   ‚îÇ
‚îÇ ‚îå‚îÄ‚ïë‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïë‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ ‚ïë             ‚îÇ (2x PUBLIC  SUBNETS) ‚îÇ             ‚ïë ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚ïë ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïë  ‚îÇ                TIER III - WEB              ‚îÇ  ‚ïë ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚ïë ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïë                                                  ‚ïë ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£  ‚ñ≤  ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                          ‚îÇ  ‚îÇ  ‚îÇ                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                            CLIENT
```

Each tier is containerized and deployed to EKS with dedicated responsibilities:

1. **Frontend Tier (Web Service)**
   - Serves static content and UI
   - Handles user interactions
   - Proxies requests to API
   - Environment Variables:
     - `PORT`: 4000
     - `API_HOST`: API service endpoint

2. **Backend Tier (API Service)**
   - Processes business logic
   - Manages database interactions
   - Handles data validation
   - Environment Variables:
     - `PORT`: 3000
     - `DBUSER`: Database username
     - `DBPASS`: Database password
     - `DBHOST`: Aurora endpoint
     - `DBPORT`: 5432
     - `DB`: Database name

3. **Database Tier (Aurora PostgreSQL)**
   - Serverless v2 for auto-scaling
   - Multi-AZ deployment
   - Automated backups
   - Encrypted at rest and in transit

## üîÑ CI/CD Pipeline Implementation

This project demonstrates a comprehensive CI/CD approach following enterprise best practices:

### üî® Continuous Integration (CI) Pipeline

Our CI process ensures code quality and security before containerization:

```mermaid
graph LR
    Dev[Developer] -->|git push| Repo[Repository]
    Repo -->|trigger| Quality[Code Quality]
    Repo -->|trigger| Security[Security Checks]
    Repo -->|trigger| Tests[Testing]
    Quality & Security & Tests -->|pass| Build[Container Build]
    Build -->|push| Registry[Container Registry]
```

1. **Code Quality Gates**
   - ESLint (`.eslintrc`) validates code style
   - Prettier enforces consistent formatting
   - SonarQube performs deep code analysis
   - Unit & integration test coverage

2. **Security Validation**
   - Dependencies audit
   - Trivy container scanning
   - SAST through SonarQube
   - Infrastructure code validation

3. **Artifact Generation**
   - Multi-stage Docker builds
   - Alpine-based images for minimal attack surface
   - Automated versioning and tagging
   - Container signing and verification

### üöÄ Continuous Delivery/Deployment (CD) Pipeline

Our CD implementation consists of three major phases:

```mermaid
graph TD
    A[Infrastructure as Code] -->|terraform apply| B[AWS Resources]
    B -->|post-install| C[Platform Services]
    C -->|argocd sync| D[Applications]

    subgraph AWS Resources
        VPC[VPC & Networking]
        EKS[EKS Cluster]
        RDS[RDS Aurora]
    end

    subgraph Platform Services
        ArgoCd[ArgoCD]
        Monitor[Prometheus/Grafana]
        Logs[Loki/Promtail]
        Secrets[Vault]
    end

    subgraph Applications
        API[API Service]
        Web[Web UI]
    end
```

1. **Infrastructure Provisioning (IaC)**
   - VPC with isolated subnets
   - EKS cluster configuration
   - Aurora PostgreSQL (Serverless v2)
   - IAM & security policies

2. **Platform Tools**
   - GitOps with ArgoCD
   - Monitoring (Prometheus/Grafana)
   - Logging (Loki/Promtail)
   - Secrets (Vault)
   - Ingress (NGINX)

3. **Application Deployment**
   - Declarative configs in Git
   - Automatic sync via ArgoCD
   - Zero-touch deployment
   - Automated rollbacks

<div align="center">
  <img src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/rainbow.png">
</div>

## üõ°Ô∏è Known Security Trade-offs

The following security checks are intentionally skipped for development purposes:

### üåç Network & Access
- **Public EKS Access** *(CKV_AWS_38, CKV_AWS_39)*
 - EKS endpoint is publicly accessible for development convenience
 - Production should restrict access to specific IP ranges

- **Auto-assign Public IPs** *(CKV_AWS_130)*
 - Subnets auto-assign public IPs for EKS worker nodes access
 - Production should use NAT Gateway + private subnets

- **Open Security Groups**
  - Security groups allow inbound traffic from 0.0.0.0/0
  - In production should be restricted to corporate IPs/VPN ranges
  - Trade-off: Easier development vs Security best practices

### üíæ Database & Backups
- **RDS Security Settings** *(CKV_AWS_162, CKV_AWS_313, CKV_AWS_139)*
 - IAM authentication disabled
 - Deletion protection disabled
 - Using default backup strategy (14 days retention)

### üìù Logging & State
- **Short Log Retention** *(CKV_AWS_338)*
 - CloudWatch logs kept for 7-30 days instead of 1 year
 - Reduced costs for non-production environments

- **State File Locking** *(CKV_TF_3)*
 - Terraform state locks disabled
 - Single developer environment doesn't require state locking

### Reference
- [PrismaCloud Security Policies](https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/)
- [AWS Security Best Practices](https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html)

<div align="center">
  <img src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/rainbow.png">
</div>

## üìã Implementation Progress

### ‚öôÔ∏è Local Development
- [x] Linux environment setup
- [x] PostgreSQL configuration
- [x] Application runtimes
- [x] Development workflow

### üîÑ CI Pipeline
- [x] Code quality automation
- [x] Test frameworks
- [x] Security scanning
- [x] Container builds

### üèóÔ∏è AWS Infrastructure
- [x] VPC & networking
- [x] EKS deployment
- [x] RDS configuration
- [x] Security setup

### ‚ö° Platform Services
- [x] ArgoCD installation
- [x] Monitoring stack
- [x] Logging pipeline
- [x] Secrets management
- [ ] Security monitoring (Falco)
- [ ] Backup solution (Velero)

### üöÄ Applications
- [ ] API service deployment
- [ ] Web UI deployment
- [ ] Integration testing
- [ ] Production readiness

## üìÅ Project Structure

```
devops-pet-project/
‚îú‚îÄ‚îÄ .github/workflows/          # CI/CD pipeline definitions
‚îú‚îÄ‚îÄ apps/                       # Application source code
‚îÇ   ‚îú‚îÄ‚îÄ api/                    # Backend service
‚îÇ   ‚îî‚îÄ‚îÄ web/                    # Frontend application
‚îú‚îÄ‚îÄ helm/                       # Kubernetes package configs
‚îú‚îÄ‚îÄ terraform/                  # Infrastructure as Code
‚îÇ   ‚îú‚îÄ‚îÄ modules/                # Reusable IaC components
‚îÇ   ‚îî‚îÄ‚îÄ environments/           # Environment configurations
‚îú‚îÄ‚îÄ k8s/                        # Kubernetes resources & ArgoCD
‚îî‚îÄ‚îÄ scripts/                    # Automation utilities
```

## üöÄ Quick Start Guide

1. **Clone & Configure**
```bash
git clone https://github.com/thejondaw/devops-pet-project.git
cd devops-pet-project
cp terraform/environments/example.tfvars terraform/environments/prod/terraform.tfvars
```

2. **Infrastructure Deployment**
```bash
make setup
make init
make plan
make apply
```

3. **Post-Installation**
```bash
make post-install
```

## üõ†Ô∏è Environment Configuration

Required variables in `terraform.tfvars`:

```hcl
region         = "your-region"
backend_bucket = "your-bucket"
environment    = "dev" "stage" "prod"

vpc_configuration = {
  cidr = "10.0.0.0/16"
  # subnet configuration...
}

db_configuration = {
  name     = "name-of-db"
  username = "username"
  password = "password"
  port     = 5432
}
```

## üìö Documentation

- [Local Development Guide](docs/local-tests.md)
- [Security Overview](docs/security.md)
- [Post-Installation Steps](docs/README.md)

## üìÑ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

<div align="center">
  <img src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/rainbow.png">
</div>
